{% extends 'dietitian_panel_base.html' %}
{% load static %}
{% block title %}Calendar{% endblock %}
{% block additional_stylesheets %}
    <link href="{% static "css/calendar.css" %}" rel="stylesheet">{% endblock %}
<meta name="csrf-token" content="{{ csrf_token }}">
{% block additional_scripts %}
    <script src="{% static "js/calendar.js" %}"
            defer
            data-month></script>{% endblock %}
{% block information %}
    <div class="calendar-container" data-container>
        <header>
            <div id="selected_year" class="d-none">{{ selected_year }}</div>
            <div id="selected_month" class="d-none">{{ selected_month }}</div>
            <div class="button-container">
                <button class="month-button" id="month-button">{{ current_month }} {{ current_year }}</button>
                <button class="year-button" id="year-button" style="display: none;">{{ current_year }}</button>
                <button class="ten-years-button" id="ten-years-button" style="display: none;">2020-2030</button>
            </div>
            <div class="arrows-wrapper">
                <i class="fa-solid fa-angle-up" id="arrow-up"></i>
                <i class="fa-solid fa-angle-down" id="arrow-down"></i>
            </div>
        </header>
        {#                <form action="{% url 'panel:show_calendar' %}" method="POST">#}
        {#                    {% csrf_token %}#}
        {#                    <select name="year">#}
        {#                        {% for year in years %}#}
        {#                            <option value="{{ year }}" {% if year == selected_year %} selected {% endif %}>{{ year }}</option>#}
        {#                        {% endfor %}#}
        {#                    </select>#}
        {#                    <select name="month">#}
        {#                        {% for number, month in months.items %}#}
        {#                            <option value="{{ number }}" {% if number == selected_month %}#}
        {#                                    selected {% endif %}>{{ month }}</option>#}
        {#                        {% endfor %}#}
        {#                    </select>#}
        {#                    <button type="submit">SUBMIT</button>#}
        {#                </form>#}

        <div class="calendar from-up">
            {% for weekday in weekdays %}
                <div class="weekday">{{ weekday }}</div>
            {% endfor %}
            {% for day in prev_days %}
                <div class="diff_day" data-prev-day="{{ day }}">{{ day }}</div>
            {% endfor %}
            {% for day in days %}
                <div data-day="{{ day }}"
                     class="day{% if selected_year == current_date.year and selected_month == current_date.month and day == current_day_num %} current_day{% endif %}">
                    {{ day }}
                    {% for group in grouped_appointments %}
                        {% for appointment in group %}
                            {% if appointment.date.year == selected_year and appointment.date.month == selected_month and appointment.date.day == day %}
                                {% if group|length > 1 %}
                                    <div class="appointment-count-container" data-count="{{ group|length }}">
                                        <div class="appointment-count">
                                            {% if forloop.first %}
                                                Appointment count: {{ group|length }}
                                            {% endif %}
                                        </div>
                                        <div class="content d-none">
                                            <div class="appointment"
                                                 data-appointment="{{ appointment.date.date }}">
                                                <div class="time">{{ appointment.date.time }}</div>
                                                <div class="title"
                                                >{{ appointment.title }}</div>
                                                <div class="duration">
                                                    Duration: {{ appointment.event_duration }}</div>
                                            </div>
                                        </div>
                                    </div>
                                {% elif group|length == 1 %}
                                    <div class="appointment"
                                         data-appointment="{{ appointment.date.date }}">
                                        <div class="time"
                                        >{{ appointment.date.time }}</div>
                                        <div class="title"
                                        >{{ appointment.title }}</div>
                                        <div class="duration">
                                            Duration: {{ appointment.event_duration }}</div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endfor %}
            {% for day in next_days %}
                <div class="diff_day" data-next-day="{{ day }}">{{ day }}</div>
            {% endfor %}
        </div>

    </div>
    <dialog class="appointment-dialog" data-appointment-dialog>
        <form method="POST">
            <button formmethod="dialog" type="submit">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="content">
                {% for group in grouped_appointments %}
                    {% for appointment in group %}
                        <div class="d-none"
                             data-dialog-content="{{ appointment.date.date }}">{{ appointment.title }}</div>
                    {% endfor %}
                {% endfor %}
            </div>
            <input type="text" name="text">
            <button type="submit">SUBMIT</button>
        </form>
    </dialog>
{% endblock %}

